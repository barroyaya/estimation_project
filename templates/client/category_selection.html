{#template/client/category_selection.html#}
{% extends 'base.html' %}

{% block title %}Sélection Catégorie - {{ projet.nom }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'index' %}">Accueil</a></li>
                <li class="breadcrumb-item"><a href="{% url 'project_selection' %}">Projets</a></li>
                <li class="breadcrumb-item active">{{ projet.nom }}</li>
            </ol>
        </nav>
        
        <h2 class="mb-4">
            <i class="fas fa-layer-group"></i> Sélection des Catégories
        </h2>
        <p class="text-muted">Projet: <strong>{{ projet.nom }}</strong>{% if projet.client %} - Client: <strong>{{ projet.client }}</strong>{% endif %}</p>
    </div>
</div>

<form method="post">
    {% csrf_token %}
    <div class="row">
        {% for type_nom, categories in categories_groupees.items %}
        <div class="col-12 mb-4">
            <h4 class="border-bottom pb-2">{{ type_nom }}</h4>
            <div class="row">
                {% for categorie in categories %}
<div class="col-md-6 col-lg-4 mb-3">
    <div class="card category-card h-100 card-hover">
        <div class="card-body">
            <h6 class="card-title">
                <!-- Icône existante -->
                {{ categorie.nom }}
            </h6>
            <p class="card-text text-muted small">{{ categorie.description|default:"" }}</p>
            
            <!-- Si c'est la catégorie main d'œuvre tuyauterie -->
            {% if categorie.nom == "Main d'œuvre Tuyauterie" or "tuyauterie" in categorie.nom|lower %}
                <div class="btn-group w-100 mb-2">
                    <button type="submit" name="categorie_id" value="{{ categorie.id }}"
                            class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-list"></i> Éléments standards
                    </button>
                    <a href="{% url 'sablage_tuyauterie' categorie.id %}" 
                       class="btn btn-outline-success btn-sm">
                        <i class="fas fa-spray-can"></i> Sablage
                    </a>
                </div>
            {% else %}
                <button type="submit" name="categorie_id" value="{{ categorie.id }}"
                        class="btn btn-outline-primary btn-sm w-100">
                    <i class="fas fa-arrow-right"></i> Sélectionner
                </button>
            {% endif %}
        </div>
    </div>
</div>
{% endfor %}
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                Aucune catégorie disponible pour le moment.
            </div>
        </div>
        {% endfor %}
    </div>
</form>

<div class="row mt-4">
    <div class="col-12">
        <div class="d-flex justify-content-between">
            <a href="{% url 'project_selection' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Retour aux projets
            </a>
            <a href="{% url 'rapport_projet' projet.id %}" class="btn btn-success">
                <i class="fas fa-file-alt"></i> Voir le rapport
            </a>
        </div>
    </div>
</div>
{% endblock %}